<div class="wrapper">
	<div *ngIf="hasEventRole" class="admin-controls">
		<span>Event registration is:</span>
		<mat-slide-toggle #slide
			color="primary"
			matTooltip="I hope you know what you're doing..."
			[checked]="srEvent?.isRegistrationOpen"
			[disabled]="!adminControlsEnabled"
			labelPosition="before"
			(change)="updateRegistrationState(slide.checked)">
			{{srEvent?.isRegistrationOpen ? 'OPEN' : 'CLOSED'}}
		</mat-slide-toggle>
		<button
			mat-mini-fab
			color="primary"
			[disabled]="adminControlsEnabled"
			(click)="enableAdminControls()">
			<mat-icon>lock_open</mat-icon>
		</button>
	</div>
	<h1>Register for {{srEvent?.name}}</h1>
	<p>In order to register for {{srEvent?.name}}, first you will need to enter your intended dates of stay. Afterwards,
		click the "Pay Attendance Fee" button in order to start the payment process. The attendence fee for {{srEvent?.shortname}}
		is USD {{ paymentAmount | currency:'USD' }}. This fee helps us cover costs related to
		running the event for attendees, such as practice TVs, hotel fees, and more. As we are still a relatively small
		event, the attendance fee is currently not waived for any individuals, including runners, volunteers, and staff.
	</p>
	<p>Below you will find a number representing the number of attendees currently registered for the event and the
		total cap. If the cap is reached and you have already begun the payment process, you will be able to finish it.
		Otherwise, you will not be able to register. Keep an eye on our <a href="https://twitter.com/rpglimitbreak">Twitter</a>
		and <a href="https://discord.gg/rpglb">Discord</a> for announcements, as occasionally we are able to increase
		the maximum cap.
	<div *ngIf="srEvent && hasFullUserLoaded && !isProcessingPayment" class="registration-container">
		<div *ngIf="srEvent.isRegistrationOpen || hasEventRole" class="attendees">
			Attendee slots taken: <span class="attendees-count">{{srEvent.registeredUsersCount}} / {{srEvent.maxRegisteredUsers}}</span>
		</div>
		<div *ngIf="user.roles.includes('attendee') || hasEventRole || (srEvent.isRegistrationOpen && srEvent.registeredUsersCount < srEvent.maxRegisteredUsers)">
			<form novalidate #f="ngForm" class="registration-form">
				<mat-form-field>
					<input
						matInput
						[min]="minDate"
						[max]="dates.endDate || maxDate"
						[matDatepicker]="startDatepicker"
						name="startDate"
						placeholder="Arrival date"
						[(ngModel)]="dates.startDate"
						(dateChange)="onDateChange()"
						required />
					<mat-datepicker-toggle matSuffix [for]="startDatepicker"></mat-datepicker-toggle>
					<mat-datepicker #startDatepicker></mat-datepicker>
				</mat-form-field>
				<mat-form-field>
					<input
						matInput
						[min]="dates.startDate || minDate"
						[max]="maxDate"
						[matDatepicker]="endDatepicker"
						name="endDate"
						placeholder="Departure date"
						[(ngModel)]="dates.endDate"
						(dateChange)="onDateChange()"
						required />
					<mat-datepicker-toggle matSuffix [for]="endDatepicker"></mat-datepicker-toggle>
					<mat-datepicker #endDatepicker></mat-datepicker>
				</mat-form-field>
			</form>
			<button
				*ngIf="!user.roles.includes('attendee')"
				mat-raised-button
				color="primary"
				class="payment-button"
				[disabled]="!f.valid || isFetching"
				(click)="handlePayment($event.target)">
				Pay Attendance Fee
				<mat-progress-bar
					*ngIf="isFetching"
					color="primary"
					mode="indeterminate">
				</mat-progress-bar>
			</button>
			<div *ngIf="user.roles.includes('attendee')" class="attendee-message success">
				<mat-icon>check_circle_outline</mat-icon>
				<span>Attendee fee paid. You're all set!</span>
			</div>
		</div>
		<div *ngIf="!srEvent.isRegistrationOpen || srEvent.registeredUsersCount >= srEvent.maxRegisteredUsers && !user.roles.includes('attendee')"
			class="warn-light registration-form">
			Sorry, registration is not currently open or has reached the limit.
		</div>
	</div>
	<div *ngIf="!srEvent || !user || !hasFullUserLoaded || isProcessingPayment" class="registration-container">
		<div class="spinner-message">{{spinnerMessage}}</div>
		<div class="spinner-error warn">{{spinnerError}}</div>
		<mat-spinner *ngIf="!spinnerError"></mat-spinner>
	</div>
</div>
